// Generated by CoffeeScript 1.6.2
(function() {
  var closeProductPopup, getArticleHeight, getOffset, getWindowScrollOffset, handleAboutUsClick, handleExpand, handleLogoClick, handleNavClick, handlePaintToggleClick, handleProductClick, handleSecondaryNavClick, handleStudioClick, initExpansionButton, log, openProductPopup, showAllArticles, showArticle;

  $(function() {
    $('.primary > .logo').click(handleLogoClick);
    $('.primary > .logo > a').click(handleLogoClick);
    $('.primary > div:not(.logo):not(.studio) > a').click(handleNavClick);
    $('.secondary > a').click(handleSecondaryNavClick);
    $('.product').click(handleProductClick);
    $('.product_popup .close, #lightbox').click(closeProductPopup);
    $('.paint_toggle').click(handlePaintToggleClick);
    $('.about_us').click(handleAboutUsClick);
    return $('.primary .studio a').click(handleStudioClick);
  });

  log = function(str) {
    return console.log(str);
  };

  handleLogoClick = function(evt) {
    var clicked;

    clicked = evt.target;
    showAllArticles();
    if ($('.page_container').hasClass('home')) {
      return;
    }
    closeProductPopup();
    setTimeout(function() {
      return $('.primary > .logo').removeClass('reappear');
    }, 400);
    $('nav.primary .selected').removeClass('selected');
    return $('.page_container').addClass('home');
  };

  handleNavClick = function(evt) {
    var clicked, groupId;

    clicked = evt.target;
    if (clicked.nodeName === 'SPAN') {
      clicked = clicked.parentNode;
    }
    $('nav.primary .selected').removeClass('selected');
    $(clicked).addClass('selected');
    groupId = $(clicked).attr('data-group-id');
    $('.products').addClass('hidden');
    $('.product_popups').addClass('hidden');
    setTimeout(function() {
      $('.products > a').each(function(i, productLink) {
        var isInGroup;

        isInGroup = $(productLink).hasClass('group' + groupId);
        if (isInGroup) {
          return $(productLink).removeClass('hidden');
        } else {
          return $(productLink).addClass('hidden');
        }
      });
      return $('.products').removeClass('hidden');
    }, 500);
    if ($('.page_container').hasClass('home')) {
      $('.page_container').removeClass('home');
      setTimeout(function() {
        return $('.primary > .logo').addClass('reappear');
      }, 1000);
    }
    return $('html, body').animate({
      scrollTop: 0
    }, 500);
  };

  handleSecondaryNavClick = function(evt) {
    var clicked, subgroupId;

    clicked = evt.target;
    if (clicked.nodeName === 'SPAN') {
      clicked = clicked.parentNode;
    }
    $('nav.secondary .selected').removeClass('selected');
    $(clicked).addClass('selected');
    subgroupId = $(clicked).attr('data-subgroup-id');
    $('.products').addClass('hidden');
    $('.product_popups').addClass('hidden');
    return setTimeout(function() {
      $('.products > a').each(function(i, productLink) {
        var isInGroup;

        isInGroup = $(productLink).hasClass('subgroup' + subgroupId);
        if (isInGroup) {
          return $(productLink).removeClass('hidden');
        } else {
          return $(productLink).addClass('hidden');
        }
      });
      return $('.products').removeClass('hidden');
    }, 500);
  };

  getOffset = function(element) {
    if (element === document.body) {
      return 0;
    } else {
      return element.offsetTop + getOffset(element.parentNode);
    }
  };

  handleProductClick = function(evt) {
    var $clicked, clicked, windowOffset;

    $clicked = evt.target.nodeName === 'A' ? $(evt.target) : $(evt.target).parents('a.product');
    clicked = $clicked.get(0);
    windowOffset = getWindowScrollOffset(clicked);
    return openProductPopup($clicked.attr('data-product-id'), clicked.offsetTop, windowOffset);
  };

  getWindowScrollOffset = function(elem) {
    var isFullyVisible, popupBottom, popupHeight, popupTop, topPadding, verticalPadding, windowBottom, windowHeight, windowTop;

    popupHeight = 470;
    windowTop = document.body.scrollTop;
    windowHeight = window.innerHeight;
    windowBottom = windowTop + windowHeight;
    verticalPadding = windowHeight - popupHeight;
    topPadding = verticalPadding / 2;
    popupTop = getOffset(elem);
    popupBottom = popupTop + popupHeight;
    isFullyVisible = popupTop > windowTop && popupBottom < windowBottom;
    if (isFullyVisible) {
      return null;
    } else {
      return popupTop - topPadding;
    }
  };

  openProductPopup = function(productId, popupOffset, windowOffset) {
    $('.product_popup.selected').removeClass('selected');
    $('.products').addClass('faded');
    $('#' + productId).css('margin-top', popupOffset + 'px').addClass('selected');
    if (windowOffset) {
      $('body').animate({
        scrollTop: windowOffset
      }, 400);
    }
    $('#lightbox').addClass('active');
    $('.product_popups').removeClass('hidden');
    return initExpansionButton($('#' + productId));
  };

  closeProductPopup = function() {
    $('.product_popups').addClass('hidden');
    $('.products').removeClass('faded');
    return $('#lightbox').removeClass('active');
  };

  handlePaintToggleClick = function(evt) {
    return $(document.body).toggleClass('disable_paint');
  };

  initExpansionButton = function(productPopup) {
    var article, articleHeight, button;

    if ($(productPopup).find('.expand').length > 0) {
      return;
    }
    article = $(productPopup).find('.article')[0];
    articleHeight = getArticleHeight(article);
    if (articleHeight > 420) {
      button = document.createElement('button');
      button.className = 'expand';
      button.innerHTML = 'EXPAND';
      article.appendChild(button);
      return $(button).click(handleExpand);
    }
  };

  handleExpand = function(evt) {
    var $popup, article, articleHeight, clicked, scrollTo;

    clicked = evt.target;
    $popup = $(clicked.parentNode.parentNode);
    article = clicked.parentNode;
    articleHeight = getArticleHeight(article);
    if (!$popup.hasClass('expanded')) {
      $(article).css('height', (articleHeight + 100) + 'px');
    } else {
      $(article).css('height', '');
      scrollTo = getWindowScrollOffset($popup[0]);
      if (scrollTo) {
        $('body').animate({
          scrollTop: scrollTo
        }, 300);
      }
    }
    $popup.css('min-height', (articleHeight + 400) + 'px');
    return $popup.toggleClass('expanded');
  };

  getArticleHeight = function(article) {
    return article.scrollHeight - 150;
  };

  handleAboutUsClick = function(evt) {
    evt.preventDefault();
    return showArticle(91);
  };

  handleStudioClick = function(evt) {
    evt.preventDefault();
    evt.stopPropagation();
    return showArticle(97);
  };

  showArticle = function(articleId) {
    $('.blog_content article:not(#article_' + articleId + ')').addClass('hidden');
    $('#article_' + articleId).removeClass('hidden');
    return $('html, body').animate({
      scrollTop: $('#article_' + articleId).offset().top - 110
    }, 500);
  };

  showAllArticles = function() {
    return $('.blog_content article').removeClass('hidden');
  };

}).call(this);
