// Generated by CoffeeScript 1.3.3
(function() {
  var closeProductPopup, getArticleHeight, handleLogoClick, handleNavClick, handlePaintToggleClick, handleProductClick, handleSecondaryNavClick, initExpansionButtons, insertExpansionButton, log, openProductPopup;

  $(function() {
    $('.primary > .logo > a').click(handleLogoClick);
    $('.primary > div:not(.logo) > a').click(handleNavClick);
    $('.secondary > a').click(handleSecondaryNavClick);
    $('.product').click(handleProductClick);
    $('.product_popup .close').click(closeProductPopup);
    $('.paint_toggle').click(handlePaintToggleClick);
    return initExpansionButtons();
  });

  log = function(str) {
    return console.log(str);
  };

  handleLogoClick = function(evt) {
    var clicked;
    clicked = evt.target;
    if ($('.page_container').hasClass('home')) {
      return;
    }
    closeProductPopup();
    setTimeout(function() {
      return $('.primary > .logo').removeClass('reappear');
    }, 400);
    $('nav.primary .selected').removeClass('selected');
    return $('.page_container').addClass('home');
  };

  handleNavClick = function(evt) {
    var clicked, groupId;
    clicked = evt.target;
    if (clicked.nodeName === 'SPAN') {
      clicked = clicked.parentNode;
    }
    $('nav.primary .selected').removeClass('selected');
    $(clicked).addClass('selected');
    groupId = $(clicked).attr('data-group-id');
    $('.products').addClass('hidden');
    $('.product_popups').addClass('hidden');
    setTimeout(function() {
      $('.products > a').each(function(i, productLink) {
        var isInGroup;
        isInGroup = $(productLink).hasClass('group' + groupId);
        if (isInGroup) {
          return $(productLink).removeClass('hidden');
        } else {
          return $(productLink).addClass('hidden');
        }
      });
      return $('.products').removeClass('hidden');
    }, 500);
    if ($('.page_container').hasClass('home')) {
      $('.page_container').removeClass('home');
      return setTimeout(function() {
        return $('.primary > .logo').addClass('reappear');
      }, 1000);
    }
  };

  handleSecondaryNavClick = function(evt) {
    var clicked, subgroupId;
    clicked = evt.target;
    if (clicked.nodeName === 'SPAN') {
      clicked = clicked.parentNode;
    }
    $('nav.secondary .selected').removeClass('selected');
    $(clicked).addClass('selected');
    subgroupId = $(clicked).attr('data-subgroup-id');
    $('.products').addClass('hidden');
    $('.product_popups').addClass('hidden');
    return setTimeout(function() {
      $('.products > a').each(function(i, productLink) {
        var isInGroup;
        isInGroup = $(productLink).hasClass('subgroup' + subgroupId);
        if (isInGroup) {
          return $(productLink).removeClass('hidden');
        } else {
          return $(productLink).addClass('hidden');
        }
      });
      return $('.products').removeClass('hidden');
    }, 500);
  };

  handleProductClick = function(evt) {
    var clicked;
    clicked = evt.target.nodeName === 'A' ? $(evt.target) : $(evt.target).parents('a.product');
    return openProductPopup(clicked.attr('data-product-id'), clicked);
  };

  openProductPopup = function(productId, productElem) {
    $('.product_popup.selected').removeClass('selected');
    $('.products').addClass('hidden');
    $('#' + productId).css('margin-top', productElem.get(0).offsetTop + 'px').addClass('selected');
    return $('.product_popups').removeClass('hidden');
  };

  closeProductPopup = function() {
    $('.product_popups').addClass('hidden');
    return $('.products').removeClass('hidden');
  };

  handlePaintToggleClick = function(evt) {
    return $(document.body).toggleClass('disable_paint');
  };

  initExpansionButtons = function() {
    var articles;
    articles = $('.product_popup .article');
    articles.each(function(i, elem) {
      var articleHeight, lastChild;
      if (elem.children.length > 0) {
        lastChild = elem.children[elem.children.length - 1];
        articleHeight = lastChild.clientHeight + lastChild.offsetTop;
        if (articleHeight > 230) {
          return insertExpansionButton(elem);
        }
      }
    });
    return $('.product_popup .expand').click(function(evt) {
      var $popup, article, articleHeight, clicked;
      clicked = evt.target;
      $popup = $(clicked.parentNode.parentNode);
      article = clicked.parentNode;
      log('height: ' + getArticleHeight(article));
      articleHeight = getArticleHeight(article);
      if (!$popup.hasClass('expanded')) {
        $(article).css('height', (articleHeight + 100) + 'px');
      } else {
        $(article).css('height', '');
      }
      $popup.css('min-height', (articleHeight + 400) + 'px');
      return $popup.toggleClass('expanded');
    });
  };

  insertExpansionButton = function(article) {
    var button;
    button = document.createElement('button');
    button.className = 'expand';
    button.innerHTML = 'EXPAND';
    return article.appendChild(button);
  };

  getArticleHeight = function(article) {
    var lastChild;
    lastChild = article.children.length > 0 && article.children[article.children.length - 1];
    if (lastChild.nodeName === 'BUTTON') {
      lastChild = article.children.length > 1 && article.children[article.children.length - 2];
    }
    return lastChild.offsetTop + lastChild.clientHeight;
  };

}).call(this);
